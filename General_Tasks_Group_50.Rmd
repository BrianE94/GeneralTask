---
title: "General_Tasks_Group_50"
author: "Long Dinh, Jonas Rieger, André Düding, Brian Eiffert, Vanessa Schweitzer"
date: "SoSe 2020, 31/07/2020"
output: 
  html_document:
    theme: paper
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data Preparation

### Step 1: Installing packages and loading libraries

If-function is necessary, otherwise error messages would pop up.
```{r, message=FALSE, warning=FALSE}
if(!require(readr)){
  install.packages("readr")
}
library(readr)

if(!require(magrittr)){
  install.packages("magrittr")
}
library(magrittr)

if(!require(dplyr)){
  install.packages("dplyr")
}
library(dplyr)

if(!require(plotly)){
  install.packages("plotly")
}
library(plotly)
```

### Step 2: Import data 

All necessary CSV files are going to be imported. Note that the first column of most CSV file imports need to be removed to get uniform datasets. 
```{r, message=FALSE, warning=FALSE} 
komponente_k7 <- read_delim("Data/Logistikverzug/Komponente_K7.csv", delim=";")%>%
  select(-X1)
logistikverzug_k7 <- read_csv("Data/Logistikverzug/Logistics_delay_K7.csv")%>%
  select(-X1)

zulassungen_alle_fahrzeuge <- read_delim("Data/Zulassungen/Zulassungen_alle_Fahrzeuge.csv", delim=";")

bestandteile_fahrzeuge_oem1_typ11 <- read_delim("Data/Fahrzeug/Bestandteile_Fahrzeuge_OEM1_Typ11.csv", delim=";")%>%
  select(-X1)
bestandteile_fahrzeuge_oem1_typ12 <- read_delim("Data/Fahrzeug/Bestandteile_Fahrzeuge_OEM1_Typ12.csv", delim=";")%>%
  select(-X1)
bestandteile_fahrzeuge_oem1_typ21 <- read_delim("Data/Fahrzeug/Bestandteile_Fahrzeuge_OEM2_Typ21.csv", delim=";")%>%
  select(-X1)
bestandteile_fahrzeuge_oem1_typ22 <- read_delim("Data/Fahrzeug/Bestandteile_Fahrzeuge_OEM2_Typ22.csv", delim=";")%>%
  select(-X1)

bestandteile_komponente_k1be1 <- read_delim("Data/Komponente/Bestandteile_Komponente_K1BE1.csv", delim=";")%>%
  select(-X1)
```

After further analysis, all data sets meet the three principles of tidy data: observations as rows, variables as columns and one type of observational unit per table.

# Task 1

Creation of new data set "logistics_delay" that contains the required information from both data sets to calculate the logistics delay between the receiving date of incoming goods and the production date, which is stored in the variable "verzugstage".

```{r, message=FALSE, warning=FALSE}
logistics_delay <- inner_join(komponente_k7, logistikverzug_k7, by="IDNummer") %>%
  select(IDNummer, Produktionsdatum, Wareneingang) %>%
  mutate(Logistikverzug = as.numeric(difftime(Wareneingang, Produktionsdatum, units="days")))
verzugstage <- logistics_delay$Logistikverzug

glimpse(logistics_delay)
head(logistics_delay)
head(verzugstage)
```

#### Subtask a
**How is the logistics delay distributed? Proof your selection by statistical tests and briefly describe your approach.**

In order to get an overview about the data distribution of logistics delay, we visualize the data by plotting a histogram.

```{r}
hist(verzugstage, breaks=10, main="Histogram of Logistics Delay", xlab="Logistics delay in days", xlim=c(6,18))
```

The histogram suggests a normal distribution. Q-Q plots are used to verify this assumption. For reference, check this [website](https://data.library.virginia.edu/understanding-q-q-plots/#). 

```{r}
qqnorm(verzugstage)  
qqline(verzugstage)
```

The normal Q-Q plot shows that the points are not on a straight line. Therefore, both sets of quantiles are not normal distributed. It is necessary to find out which distribution model fits the data best. 

#### Subtask b
**What is the minimum/maximum time between delivering and receiving goods?**

```{r}
max_logistics_delay <- max(verzugstage)
max_logistics_delay
min_logistics_delay <- min(verzugstage)
min_logistics_delay
```
The minimum/maximum time between delivering and receiving goods are the minimum/maximum days of logistics delay. Hence, the minimum time is `r min_logistics_delay` days and the maximum time is `r max_logistics_delay` days.

#### Subtask c
**Determine the mean of the logistics delay.**

```{r}
mean_logistics_delay <- round(mean(verzugstage),1)
mean_logistics_delay
```
The mean of the logistics delay is `r mean_logistics_delay` days.

#### Subtask d
**Visualize the distribution in an appropriate way by displaying a histogram and the density function using the package plotly.**

Histogram visualization according to [plotly.com](https://plotly.com/r/histograms/).

```{r, message=FALSE, warning=FALSE}

fig <- plot_ly(
  x = ~verzugstage, type = "histogram"
)

fig

#Verteilung muss erst herausgefunden werden!

```

# Task 2

#### Subtask a
**Why does it make sense to store the available data in separate files instead of saving everything in a huge table? Name at least four benefits.**

The benefits are the reduction of the loading time of the imported data and the reduction of the high working memory consumption. It also avoids redundancy in big tables, as usually some values appear several times in the table/spreadsheet. The search time (duration) for exact figures/numbers in the table is therefore also reduced, as it is itself smaller and more compact.

#### Subtask b
**The available tables represent a typical data base structure. How is it called?**

The typical data base structure is called relational database system. 

# Task 3

**How many of the parts T4 ended up in vehicles registered in the city of Dortmund?**

In order to find the parts T4, which ended up in vehicles registered in the city of Dortmund, we filtered the cars according to this municipality. Then, we linked all components that have been installed in vehicles together in one table. Furthermore, we joined both tables combining all registered vehicles in Dortmund with the engine component. Finally, we filtered for all engines K1BE1, which all include the T4 part, that are also assembled in vehicles registered in Dortmund. 

```{r}
# At first, we filter for all the vehicles registered in Dortmund
zulassungen_dortmund <- zulassungen_alle_fahrzeuge %>%
  filter(Gemeinden=="DORTMUND")

# After filtering the registered vehicles in the city of Dortmund, we select the car "IDNummer" within all the produced vehicles and the "ID_Motor" because T4 is part of the engine
bestandteile_fahrzeuge_alle <- bind_rows(bestandteile_fahrzeuge_oem1_typ11, bestandteile_fahrzeuge_oem1_typ12, bestandteile_fahrzeuge_oem1_typ21, bestandteile_fahrzeuge_oem1_typ22) %>%
  select(ID_Motor, ID_Fahrzeug)

# Joining all registered vehicles in Dortmund with the component engine list
zulassungen_dortmund_bestandteile_fahrzeuge_alle <- inner_join(zulassungen_dortmund, bestandteile_fahrzeuge_alle, by=c("IDNummer" = "ID_Fahrzeug"))

# T4 only appears to be a part of the component engine K1BE1.
t4_bestandteile_fahrzeuge_alle_dortmund <- inner_join(bestandteile_komponente_k1be1, zulassungen_dortmund_bestandteile_fahrzeuge_alle, by = c("ID_K1BE1" = "ID_Motor"))
```

In total, `r nrow(t4_bestandteile_fahrzeuge_alle_dortmund)` T4 parts ended up in vehicles registered in the city of Dortmund. 

# Task 4

**Which data types do the attributes of the registration table "Zulassungen_aller_Fahrzeuge" have? Put your answers into a table which is integrated into your Markdown document.**

To get an overview about the data structure and the data types of the attributes, we explore the raw data by applying str(). 

```{r, message=FALSE, warning=FALSE}
str(zulassungen_alle_fahrzeuge)
```
The data types of the attributes of the registration table are as following:

"X1" = `r class(zulassungen_alle_fahrzeuge$X1)`,
"IDNummer" = `r class(zulassungen_alle_fahrzeuge$IDNummer)`,
"Gemeinden" = `r class(zulassungen_alle_fahrzeuge$Gemeinden)`,
"Zulassung" = `r class(zulassungen_alle_fahrzeuge$Zulassung)`.

# Task 5
#### Subtask a
**You want to publish your application. Why does it make sense to store the data sets in a database on a server?** 

A server is available 24/7.

A server usually has hardware-based a lot more computing power than local computers. Technical issues like overcapacities can be avoided. 

Apart from the computing power, servers usually also provide more storage than local computers. The necessary data can have a larger size. Also redundancies can be installed as an additional safety measure. 

#### Subtask b
**Why is it not recommended to store the data sets on your personal computer? Name at least three points per question.**

It is not recommended to store the data sets on your computer because of the limited accessibility it entails. Your personal device is (supposely) not available 24/7 per day. 

Furthermore, external access from other users are not possible. No application can be run on other devices/computers.

The amount of data combined with the data analysis require huge memory capacity. Local computers (depending on the hardware) might not be able to process it.

# Task 6

**On 11 August 2019 there was an accident involving a stolen car produced by your company. The driver left the scene without a trace. The license plate of the car, which caused the accident, was faked and the Vehicle Identification Number (VIN) was removed. Since you work for the Federal Motor Transport Authority, the police asks for your help to find out where the vehicle with the engine code "K1DI2-103-1031-21" (corresponds to the engine ID number) was registered.**

In order to get the specific engine ID number, we filtered for it within the list of all vehicle components. Then, comparing this specific engine ID with the vehicle registration list results in the exact location of the stolen car. 

```{r}
#Filtering for the specific engine motor ID within all vehicle components
id_motor_k1di2_103_1031_21 <- bind_rows(bestandteile_fahrzeuge_oem1_typ11, bestandteile_fahrzeuge_oem1_typ12, bestandteile_fahrzeuge_oem1_typ21, bestandteile_fahrzeuge_oem1_typ22)%>%
  select(ID_Motor, ID_Fahrzeug)%>%
    filter(ID_Motor=="K1DI2-103-1031-21")

#Joining vehicle registration list with the filtered motor id from above to get the exact location of the stolen car
zulassungen_id_motor <- right_join(zulassungen_alle_fahrzeuge, id_motor_k1di2_103_1031_21, by=c("IDNummer"="ID_Fahrzeug"))

#Storing the location of the registered vehicle with the specific engine number in a variable
location <- zulassungen_id_motor$Gemeinden
```

The vehicle with the engine code/ID number "K1DI2-103-1031-21" was registered in `r location`.